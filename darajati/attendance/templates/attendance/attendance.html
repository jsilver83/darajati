{% extends "base.html" %}
{% load i18n %}
{% block content %}
<div class="content-panel">
    <div class="cntnt-sec">
        {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li
                    {% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}
            </li>
            {% endfor %}
        </ul>
        {% endif %}
        <br>
        <h3>{% trans 'Available Attendance Days - Select one to show the attendance' %}</h3>
        <div class="btn-group">
            {% for period in periods %}
            <a href="{% url 'attendance:section_day_attendance' day=period.day|lower section_id=period.section_id %}"
               class="btn green" role="button"> {{ period.day }} </a>
            {% endfor %}
        </div>
        {% if formset.forms %}
        <form method="post">
            <table class="table">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Student ID</th>
                    <th>Full Name</th>
                    <th>A</th>
                    <th>L</th>
                    <th>E</th>
                    {% for period in current_periods %}
                    <th> Period {{ forloop.counter }} - {{ period.start_time }} ~ {{period.end_time }}</th>
                    {% endfor %}
                </tr>
                </thead>
                <tbody>
                {% csrf_token %}
                {{ formset.management_form }}
                {% for form in formset %}
                {% ifchanged form.enrollment.value %}
                <tr>
                    <th scope="row">{{form.index.value}}</th>
                    <td>{{ form.student_university_id }}</td>
                    <td>{{ form.student_name }}</td>
                    <td>
                        {% for enrollment in enrollments %}
                        {% if form.enrollment.value == enrollment.enrollment %}
                        {% ifequal enrollment.status 'abs' %}{{ enrollment.total }}{% endifequal %}
                        {% endif %}
                        {% endfor %}
                    </td>
                    <td>
                        {% for enrollment in enrollments %}
                        {% if form.enrollment.value == enrollment.enrollment %}
                        {% ifequal enrollment.status 'lat' %}{{ enrollment.total }}{% endifequal %}
                        {% endif %}
                        {% endfor %}
                    </td>
                    <td>
                        {% for enrollment in enrollments %}
                        {% if form.enrollment.value == enrollment.enrollment %}
                        {% ifequal enrollment.status 'exc' %}{{ enrollment.total }}{% endifequal %}
                        {% endif %}
                        {% endfor %}
                    </td>
                    <td>{{ form.status }}
                        <button type="button" class="btn" data-toggle="tooltip" data-placement="bottom"
                                title="Updated By : {{ form.updated_by.value }}, Updated On : {{ form.updated_on.value }}">
                            !
                        </button>
                    </td>
                    {{form.enrollment}}
                    {{form.id}}
                    {{form.attendance_instance}}

                    {% else %}

                    {% if form.id.value != None %}
                    <span style="display: none;">{{ form.student_name }}</span>
                    <td>{{ form.status }}
                        <button type="button" class="btn" data-toggle="tooltip" data-placement="bottom"
                                title="Updated By : {{ form.updated_by.value }}, Updated On : {{ form.updated_on.value }}">
                            !
                        </button>
                    </td>
                    {{form.enrollment}}
                    {{form.id}}
                    {{form.attendance_instance}}
                    {% endif %}

                    {% endifchanged%}
                    {% endfor %}
                </tr>
                </tbody>
            </table>
            <input class="btn btn-default" type="submit" value="submit" style="margin-top: 1%">
        </form>
        {% else %}
        {% trans 'There are no students' %}
        {% endif %}
    </div>
</div>
{% endblock %}