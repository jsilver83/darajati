{% extends "base.html" %}
{% load i18n staticfiles %}
{% block content %}
    <div class="content-panel">
        <div class="cntnt-sec">
            {% if formset.forms %}
                <form method="post">
                <div class="title-sec row">
                    <div class="col-md-9">
                        <h3>{% trans 'Available attendance days for section ' %}{{ section.code }}</h3>
                        <p>{% trans 'Select one to show the attendance' %}</p>
                    </div>
                    <div class="col-md-3 text-right">
                        <!--<div class="save-atten">
                        <a href="javascript:void(0);" class="thm-btn small-btn outline-btn-dgrey cancel-btn">{% trans 'Cancel' %}</a>&nbsp;&nbsp;
                        <input class="thm-btn small-btn" type="submit" value="{% trans 'Save' %}">
                    </div>-->
                        <input class="thm-btn small-btn save-btn" type="submit" value="{% trans 'Save' %}">
                        <!--<a href="javascript:void(0);" class="thm-btn small-btn edit-btn">{% trans 'Edit' %}</a>-->
                    </div>
                </div>
                <div class="btn-group avail-attend-days">
                    {% if previous_week %}
                        <a href="{% url 'attendance:section_day_attendance' year=previous_week.date.year month=previous_week.date.month day=previous_week.date.day section_id=previous_week.section_id %}"
                           class="btn green days" role="button">{% trans 'Previous Week' %}
                            <span class="attend-date">{{ previous_week.day }}, {{ previous_week.date }}</span>
                        </a>
                    {% endif %}
                    {% for period in periods %}
                        {% if period.date == current_date %}
                            <a href="{% url 'attendance:section_day_attendance' year=period.date.year month=period.date.month day=period.date.day section_id=period.section_id %}"
                               class="btn green days active-period" role="button"> {{ period.day }}
                                <span class="attend-date">{{ period.date }}</span>
                            </a>
                        {% else %}
                            <a href="{% url 'attendance:section_day_attendance' year=period.date.year month=period.date.month day=period.date.day section_id=period.section_id %}"
                               class="btn green days" role="button"> {{ period.day }}
                                <span class="attend-date">{{ period.date }}</span>
                            </a>
                        {% endif %}
                    {% endfor %}
                    {% if next_week %}
                        <a href="{% url 'attendance:section_day_attendance' year=next_week.date.year month=next_week.date.month day=next_week.date.day section_id=next_week.section_id %}"
                           class="btn green days" role="button">{% trans 'Next Week' %}
                            <span class="attend-date">{{ next_week.day }}, {{ next_week.date }}</span>
                        </a>
                    {% endif %}
                </div>
                <div class="thm-table odd period-cntnt">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>{% trans 'No.' %}</th>
                            <th>{% trans 'ID' %}</th>
                            <th>{% trans 'Name' %}</th>
                            <th>{% trans 'A' %}</th>
                            <th>{% trans 'L' %}</th>
                            <th>{% trans 'E' %}</th>
                            {% for period in current_periods %}
                                <th>{{ period.start_time }}{% trans ' to ' %}{{ period.end_time }}</th>
                            {% endfor %}
                        </tr>
                        </thead>
                        <tbody>
                        {{ formset.non_field_errors }}
                        {% csrf_token %}
                        {{ formset.management_form }}
                        {% for form in formset %}
                            {{ form.enrollment }}
                            {{ form.id }}
                            {{ form.attendance_instance }}
                            {% ifchanged form.enrollment.value %}
                                <tr>
                                <td>{{ form.enrollment_id }}</td>
                                <td>{{ form.student_university_id }}</td>
                                <td>{{ form.student_name }}</td>
                                <td>
                                    {% for enrollment in enrollments %}
                                        {% if form.enrollment.value == enrollment.enrollment %}
                                            {% ifequal enrollment.status 'abs' %}
                                                {{ enrollment.total }}
                                            {% endifequal %}
                                        {% endif %}
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for enrollment in enrollments %}
                                        {% if form.enrollment.value == enrollment.enrollment %}
                                            {% ifequal enrollment.status 'lat' %}{{ enrollment.total }}{% endifequal %}
                                        {% endif %}
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for enrollment in enrollments %}
                                        {% if form.enrollment.value == enrollment.enrollment %}
                                            {% ifequal enrollment.status 'exc' %}{{ enrollment.total }}{% endifequal %}
                                        {% endif %}
                                    {% endfor %}
                                </td>
                                <td class="{% ifequal form.status.value 'abs' %}error{% endifequal %}{% ifequal form.status.value 'lat' %}warning{% endifequal %}{% ifequal form.status.value 'exc' %}success{% endifequal %}">
                                    <div class="row">
                                        <div class="col-md-8">{{ form.status }}{{ form.status.errors }}</div>
                                        <div class="col-md-4 info text-right">
                                            <img class="info-icon" src="{% static 'images/info.png' %}"/>
                                            <div class="info-cntnt">
                                                <span>Updated By : {{ form.updated_by }}</span>
                                                <span>Updated On : {{ form.updated_on }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </td>

                            {% else %}

                                {% if form.id.value != None %}
                                    <span style="display: none;">{{ form.enrollment_id }}</span>
                                    <span style="display: none;">{{ form.student_name }}</span>
                                    <span style="display: none;">{{ form.student_university_id }}</span>
                                    <td class="{% ifequal form.status.value 'abs' %}error{% endifequal %}{% ifequal form.status.value 'lat' %}warning{% endifequal %}{% ifequal form.status.value 'exc' %}success{% endifequal %}">
                                        <div class="row">
                                            <div class="col-md-8">{{ form.status }}{{ form.status.errors }}</div>
                                            <div class="col-md-4 info text-right">
                                                <img class="info-icon" src="{% static 'images/info.png' %}"/>
                                                <div class="info-cntnt">
                                                    <span>Updated By : {{ form.updated_by }}</span>
                                                    <span>Updated On : {{ form.updated_on }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                {% endif %}

                            {% endifchanged %}
                        {% endfor %}
                        </tr>
                        </tbody>
                    </table>
                </div>
            {% else %}
                {% trans 'There are no students' %}
            {% endif %}
            </form>
        </div>
    </div>
{% endblock %}

{% block scripts %}
	<script type="text/javascript" src="{% static 'js/custom-attendance.js' %}"></script>
{% endblock %}