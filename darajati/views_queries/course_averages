SELECT ROW_NUMBER() OVER () AS ID, Q.*, Q.GRADES_AVERAGE / Q.WEIGHT * 100 GRADES_AVERAGE_PERCENTAGE FROM (
SELECT
  GRADE_GRADEFRAGMENT.COURSE_OFFERING_ID,
  ENROLLMENT_SEMESTER.ID SEMESTER_ID, 
  ENROLLMENT_SEMESTER.CODE SEMESTER_CODE, 
  ENROLLMENT_COURSE.ID COURSE_ID, 
  ENROLLMENT_COURSE.CODE COURSE_CODE, 
  GRADE_GRADEFRAGMENT.ID GRADE_FRAGMENT_ID,
  GRADE_GRADEFRAGMENT.CATEGORY, 
  GRADE_GRADEFRAGMENT.DESCRIPTION, 
  GRADE_GRADEFRAGMENT.WEIGHT, 
  AVG(GRADE_STUDENTGRADE.GRADE_QUANTITY) GRADES_AVERAGE
FROM 
  PUBLIC.GRADE_GRADEFRAGMENT, 
  PUBLIC.GRADE_STUDENTGRADE, 
  PUBLIC.ENROLLMENT_COURSEOFFERING, 
  PUBLIC.ENROLLMENT_COURSE, 
  PUBLIC.ENROLLMENT_SEMESTER
WHERE 
  GRADE_GRADEFRAGMENT.COURSE_OFFERING_ID = ENROLLMENT_COURSEOFFERING.ID AND
  GRADE_STUDENTGRADE.GRADE_FRAGMENT_ID = GRADE_GRADEFRAGMENT.ID AND
  ENROLLMENT_COURSEOFFERING.SEMESTER_ID = ENROLLMENT_SEMESTER.ID AND
  ENROLLMENT_COURSEOFFERING.COURSE_ID = ENROLLMENT_COURSE.ID AND
  GRADE_STUDENTGRADE.GRADE_QUANTITY IS NOT NULL
GROUP BY
  GRADE_GRADEFRAGMENT.COURSE_OFFERING_ID,
  ENROLLMENT_SEMESTER.ID, 
  ENROLLMENT_SEMESTER.CODE, 
  ENROLLMENT_COURSE.ID, 
  ENROLLMENT_COURSE.CODE, 
  GRADE_GRADEFRAGMENT.ID,
  GRADE_GRADEFRAGMENT.CATEGORY, 
  GRADE_GRADEFRAGMENT.DESCRIPTION, 
  GRADE_GRADEFRAGMENT.WEIGHT) Q